# Tetris_C

テトリスを作ろう のハンズオンにトライしてみました。  

開発環境は `Ubuntu Server 20.04` です。  
それ以外の環境での動作確認はしていません。  

リファクタリングをしたり、追加要素を加えたりしています。  
最終的にはだいぶコードが変わってしまいました。  


## Tetris_C ?

みんなご存知の、あのテトリスです。  
ターミナルで動作します。  


## 遊び方

### インストール方法

このリポジトリをまるごとクローンしてください。  
他のゲームもまとめてインストールされてしまいますが、不要なら削除してください。  
必要なのは `Tetris_C` ディレクトリだけです。  
```sh
git clone https://github.com/mznmk/HandsOn_Game.git
```

### 起動方法

1. 実行ファイル作成  
	Makefile があるディレクトリ（このディレクトリ）で、実行ファイルを作成します。  
	ターミナルで次のコマンドを実行すると、実行ファイルが作成されます。  
	```sh
	make re
	```

2. ゲーム開始  
	次のコマンドを実行すると、ゲームが始まります。  
	```sh
	./tetris
	```
	フィールドのサイズを指定することもできます。  
	（この場合、縦20・横10のサイズでゲームが始まります。）  
	```sh
	./tetris 20 10
	```


3. ゲーム終了  
	ゲーム中に `Ctrl + C` を入力すると、ゲームが終了します。  


### 操作方法

キーボードで操作します。  
`wasd` `矢印` だけでも操作できますが、  
左手でブロック移動操作、右手でブロック回転操作をするのがおすすめです。  
（テンキーがあるなら `矢印` + `0` + `.` 、ないなら `wasd` + `.` + `.` のように。）  

|入力|入力に対する動作|
|:--------------------:|:----------------------:|
|`←` / `a`            |ブロックが左に移動します|
|`→` / `d`            |ブロックが右に移動します|
|`↓` / `s`            |ブロックが一気に落ちます|
|`↑` / `w` / `,` / `0`|ブロックが左回転します　|
|`.`                   |ブロックが左回転します　|

### アンインストール方法

ディレクトリを削除してください。  
システムに変更を加えていませんので、ディレクトリを削除するだけで大丈夫です。  


## テキストの特徴・注意点

- 文章で詳細に解説されていて、とても理解しやすいです。  

- 学習目的のものなので、最適化はされていません。  

- 開発状況によって、`#include`するライブラリを変更する必要があるかもしれません。  
`#include <termios.h>` → `#include <term.h>`  
`#include <sys/types.h>` → `#include <sys/select.h>`  
自身の環境だと、このように変更したような気がします。  

- ところどころバグがあります。  
（ブロックを回転させる時に衝突判定をしていない、など）  

- C言語の伝統的な流儀で、各種判定関数の戻り値に True=0 False=-1 を使っています。  
Truty の感覚が異なるかもしれません。  

- 突然 `\0` や `' '` が出てきますが、 `'\0'` : 何もなし `' '`: ブロック です。  
各種判定に使われています。  

- ワンライナーの関数は、関数としてではなくマクロで定義されています。  


## 学んだこと

- まず確実に動く小さなプログラムも作って、それを少しずつ大きくするほうが良いです。  

- ２Ｄのゲームだと、意外と数学の知識は必要ない..？という感じがしました。  

- テトリスは意外と簡単なアルゴリズムでできていました。  

- フィールドのサイズをちょっと変更するだけで、ゲームバランスが大幅に変わりました。  

- デバッグ実行時、油断をすると遊んでしまって時間が解けてしまいました。  

- ゲームプログラミングは沼です。  
どんどん要素を追加したくなって、終わりが見えなくなります。  

- ちゃんと紙に書かず、頭だけで設計したので、思考の抜け漏れに気づけませんでした。  
あとで大幅な仕様変更をするはめになりました。   

- README を書くと、なんかすごそうなプログラムに見えると気づきました。（笑）  


## 参考資料

テトリスを作ろう  
http://www3.nit.ac.jp/~tamura/pdf/tetris.pdf  


コマンドライン引数  
http://www.ritsumei.ac.jp/~mmr14135/johoWeb/cmnds.html  

C言語 extern宣言とグローバル変数【宣言不要な設計手法】  
https://monozukuri-c.com/langc-funclist-extern/  


C言語で２次元配列を動的に割り当てる４つの方法  
https://tondol.hatenablog.jp/entry/20090713/1247426321  

【ダブルフリー】C言語のfree()で痛い目を見ないただ一つの方法【予防】  
https://naruport.com/blog/2019/7/2/safe-free/  


碧色工房 - エスケープシーケンス  
https://www.mm2d.net/main/prog/c/console-01.html  


ターミナルの幅をC言語で取得  
https://qiita.com/hidetzu/items/2978f63e6d9b1848d8fe  


C言語でシグナルをハンドルする  
https://qiita.com/supaiku2452/items/10772cbd2706dede06b9  

Linux シグナルの基本と仕組み (カーネル v5.5 時点)   
https://qiita.com/Kernel_OGSun/items/e96cef5487e25517a576  


select関数を用いた標準入力の監視【Linux / C言語】  
https://zenn.dev/kedama_nth/articles/13a40615312460  



