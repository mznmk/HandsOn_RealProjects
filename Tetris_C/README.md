# Tetris_C

テトリスを作ろう のハンズオンにトライしてみました。  

開発環境は `Ubuntu Server 20.04` です。  
それ以外の環境での動作確認はしていません。  

リファクタリングをしたり、追加要素を加えたりしています。  
最終的にはだいぶコードが変わってしまいました。  


## Tetris_C ?

みんなご存知の、あのテトリスです。  
ターミナルで動作します。  


## 遊び方

### インストール方法

このリポジトリをまるごとクローンしてください。  
他のゲームもまとめてインストールされてしまいますが、不要なら削除してください。  
必要なのは `Tetris_C` ディレクトリだけです。  
```sh
git clone https://github.com/mznmk/HandsOn_Game.git
```

### 起動方法

1. Makefile があるディレクトリ（このディレクトリ）で、実行ファイルを作成します。  
ターミナルで次のコマンドを実行すると、実行ファイルが作成されます。  
	```sh
	make re
	```

2. 次のコマンドを実行すると、ゲームが始まります。  
	```sh
	./tetris
	```

### 操作方法

キーボードで操作します。  
`wasd` `矢印` だけでも操作できますが、  
左手でブロック移動操作、右手でブロック回転操作をするのがおすすめです。  
（テンキーがあるなら `矢印` + `0` + `.` 、ないなら `wasd` + `.` + `.` のように。）  

|入力|入力に対する動作|
|:--------------------:|:----------------------:|
|`←` / `a`            |ブロックが左に移動します|
|`→` / `d`            |ブロックが右に移動します|
|`↓` / `s`            |ブロックが一気に落ちます|
|`↑` / `w` / `,` / `0`|ブロックが左回転します　|
|`.`                   |ブロックが左回転します　|

### アンインストール方法

ディレクトリを削除してください。  
システムに変更を加えていませんので、ディレクトリを削除するだけで大丈夫です。  


## テキストの特徴・注意点

- 文章で詳細に解説されていて、とても理解しやすいです。  

- 学習目的のものなので、最適化はされていません。  

- 開発状況によって、`#include`するライブラリを変更する必要があるかもしれません。  
`#include <termios.h>` → `#include <term.h>`  
`#include <sys/types.h>` → `#include <sys/select.h>`  
自身の環境だと、このように変更したような気がします。  

- ところどころバグがあります。  
（ブロックを回転させる時に衝突判定をしていない、など...）  

- C言語の伝統的な流儀で、各種判定関数の戻り値に True=0 False=-1 を使っています。  
Truty の感覚が異なるかもしれません。  

- 突然 `\0` や `' '` が出てきますが、 `'\0'` : 何もなし `' '`: ブロック です。  
各種判定に使われています。  

- ワンライナーの関数は、関数としてではなくマクロで定義されています。  


## 学んだこと

- まず確実に動く小さなプログラムも作り、それを少しずつ大きくするほうがいい。  

- ２Ｄのゲームだと、もしかして、意外と数学の知識は必要ない..？  

- テトリスは意外と簡単なアルゴリズムでできている。  

- フィールドのサイズをちょっと変更するだけで、ゲームバランスが大幅に変わる。驚き！  

- デバッグ実行時、油断をすると遊んでしまって時間が解けてしまう。あぶない。  

- ゲームプログラミングは沼。どんどん要素を追加したくなる。あぶない。  

- 仕様変更の際、コード全体の大幅な変更が必要が生じることがある（生じた）。  
最初にいろいろシミュレートして、ちゃんと設計しておかないと死ぬ！超危険！  

- README を書くと、なんかすごそうなプログラムに見える！（笑）  


## 参考資料

テトリスを作ろう  
http://www3.nit.ac.jp/~tamura/pdf/tetris.pdf  

碧色工房 - エスケープシーケンス  
https://www.mm2d.net/main/prog/c/console-01.html  

select関数を用いた標準入力の監視【Linux / C言語】  
https://zenn.dev/kedama_nth/articles/13a40615312460  

C言語 extern宣言とグローバル変数【宣言不要な設計手法】  
https://monozukuri-c.com/langc-funclist-extern/  

C言語でシグナルをハンドルする  
https://qiita.com/supaiku2452/items/10772cbd2706dede06b9  

Linux シグナルの基本と仕組み (カーネル v5.5 時点)   
https://qiita.com/Kernel_OGSun/items/e96cef5487e25517a576  

